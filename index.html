<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SK일렉링크 채용 전략 대시보드</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f4f7f6; margin: 0; padding: 20px; color: #333; }
        .header { background: #E6221A; color: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(230, 34, 26, 0.2); }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 25px; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.05); border: 1px solid #eee; }
        .full-width { grid-column: 1 / -1; }
        .metric-container { display: flex; gap: 20px; margin-bottom: 25px; }
        .metric-card { flex: 1; background: white; padding: 20px; border-radius: 12px; text-align: center; border-left: 5px solid #E6221A; }
        .metric-value { font-size: 2.2rem; font-weight: bold; color: #E6221A; }
        h3 { margin-top: 0; font-size: 1.1rem; color: #555; display: flex; justify-content: space-between; }
        canvas { width: 100% !important; max-height: 350px; }
    </style>
</head>
<body>

<div class="header">
    <h1 style="margin:0">SK electlink Recruiting Insights</h1>
    <p style="margin:5px 0 0 0; opacity: 0.9;">채용 현황 및 조직별 T.O 실시간 대시보드</p>
</div>

<div class="metric-container">
    <div class="metric-card">
        <h3>현재 오픈 공고 (진행중)</h3>
        <div id="openCount" class="metric-value">-</div>
    </div>
    <div class="metric-card">
        <h3>평균 채용 리드타임</h3>
        <div id="avgLeadTime" class="metric-value">-</div>
    </div>
    <div class="metric-card">
        <h3>2026 전체 잔여 T.O</h3>
        <div id="totalTO" class="metric-value">-</div>
    </div>
</div>

<div class="grid">
    <div class="card full-width">
        <h3>조직 및 셀별 잔여 T.O (상위조직 기준 정렬)</h3>
        <canvas id="toChart"></canvas>
    </div>

    <div class="card">
        <h3>고용 형태별 현황 (진행 vs 완료)</h3>
        <canvas id="typeChart"></canvas>
    </div>

    <div class="card">
        <h3>채용 사유별 현황 (진행 vs 완료)</h3>
        <canvas id="reasonChart"></canvas>
    </div>
</div>

<script>
    const posUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS4NyWr_pNBx82IrYqAeZV60ST3D14ZzH2F1uYsHrpGWQ9PQ8KP8MLR98Ao_yppXjwqoHwqR-AvLRyR/pub?gid=867729802&single=true&output=csv";
    const toUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS4NyWr_pNBx82IrYqAeZV60ST3D14ZzH2F1uYsHrpGWQ9PQ8KP8MLR98Ao_yppXjwqoHwqR-AvLRyR/pub?gid=770067438&single=true&output=csv";

    async function init() {
        Papa.parse(posUrl, { download: true, header: true, complete: res => processPos(res.data) });
        Papa.parse(toUrl, { download: true, header: true, complete: res => processTO(res.data) });
    }

    function processPos(data) {
        const active = data.filter(d => d['상태'] === '진행중');
        const done = data.filter(d => d['상태'] === '완료');

        document.getElementById('openCount').innerText = active.length + "건";

        // 리드타임 계산
        let days = 0, cnt = 0;
        done.forEach(p => {
            const s = new Date(p['오픈 날짜']), e = new Date(p['최종 합격일']);
            if(!isNaN(s) && !isNaN(e)) { days += (e-s)/(1000*60*60*24); cnt++; }
        });
        document.getElementById('avgLeadTime').innerText = cnt > 0 ? Math.round(days/cnt) + "일" : "- 일";

        // 고용형태/사유 차트 (Stack Bar)
        createStackChart('typeChart', active, done, '고용형태', ['정규직','계약직','파견직','용역직']);
        createStackChart('reasonChart', active, done, '채용사유', ['신규채용','대체채용']);
    }

    function processTO(data) {
        // T.O 시트 분석: 빈 값이 포함될 수 있으므로 필터링
        const labels = data.map(d => d['조직']).filter(l => l);
        const values = data.map(d => parseInt(d['2026년 잔여 TO']) || 0);
        const total = values.reduce((a, b) => a + b, 0);
        document.getElementById('totalTO').innerText = total + "명";

        new Chart(document.getElementById('toChart'), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: '잔여 T.O (단위: 명)',
                    data: values,
                    backgroundColor: data.map(d => d['조직'].includes('팀') ? '#E6221A' : '#F37021'), // 팀 단위는 빨간색, 셀 단위는 주황색 구분
                    borderRadius: 5
                }]
            },
            options: { indexAxis: 'y' } // 가로 막대형으로 변경하여 가독성 증대
        });
    }

    function createStackChart(id, active, done, field, labels) {
        const activeData = labels.map(l => active.filter(d => d[field] === l).length);
        const doneData = labels.map(l => done.filter(d => d[field] === l).length);

        new Chart(document.getElementById(id), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    { label: '진행중', data: activeData, backgroundColor: '#E6221A' },
                    { label: '채용완료', data: doneData, backgroundColor: '#53565A' }
                ]
            },
            options: { scales: { x: { stacked: true }, y: { stacked: true } } }
        });
    }

    init();
</script>
</body>
</html>
